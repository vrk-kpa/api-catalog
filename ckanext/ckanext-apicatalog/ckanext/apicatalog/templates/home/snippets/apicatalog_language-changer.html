{% set current_url = request.environ.CKAN_CURRENT_URL %}
{% set current_lang = request.environ.CKAN_LANG %}
{% set lang_code = 'en' if current_lang == 'en_GB' else current_lang %}
<div class="btn-group language-changer">
  <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    {{ lang_code|upper }} <i class="fa fa-chevron-down"></i>
  </button>
  <ul class="dropdown-menu">
    {% for lang, locale in [('fi', 'fi'), ('sv', 'sv'), ('en', 'en_GB')] %}
      <li {% if current_lang == locale %} class="active" {% endif %}><a href="{% url_for h.unquote_url(current_url), locale=locale %}">{{ lang|upper }}</a></li>
    {% endfor %}
  </ul>
</div>
