- name: Check existance of node_modules
  stat:
    path: "{{ apicatalog_ui_path }}/node_modules"
  register: node_modules

- fail:
    msg: Please run npm install in ckanext_apicatalog_ui on host machine
  when: not node_modules.stat.exists

- name: re-minify ckanext-apicatalog_ui module javascript files
  shell: ./bin/paster --plugin=ckan minify "{{ apicatalog_ui_ckanext_path }}/fanstatic/javascript/modules" "--config={{ ckan_ini }}" chdir="{{ virtualenv }}"
  tags:
    - frontend-build

- name: rebuild ckanext-apicatalog_ui less
  shell: lessc "{{ apicatalog_ui_path }}/less/main.less" "{{ apicatalog_ui_ckanext_path }}/fanstatic/main.css"
